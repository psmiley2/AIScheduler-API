function cov_zcw5eg62c(){var path="C:\\Users\\peter\\Desktop\\Files\\perhail\\server\\routes\\users.js";var hash="2f722390bf019fa64b1f5ae8fcc94ab9fde9fbf1";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"C:\\Users\\peter\\Desktop\\Files\\perhail\\server\\routes\\users.js",statementMap:{"0":{start:{line:1,column:16},end:{line:1,column:34}},"1":{start:{line:2,column:15},end:{line:2,column:32}},"2":{start:{line:3,column:15},end:{line:3,column:31}},"3":{start:{line:4,column:19},end:{line:4,column:21}},"4":{start:{line:8,column:0},end:{line:43,column:3}},"5":{start:{line:10,column:19},end:{line:13,column:5}},"6":{start:{line:14,column:15},end:{line:14,column:18}},"7":{start:{line:15,column:17},end:{line:15,column:63}},"8":{start:{line:16,column:4},end:{line:16,column:25}},"9":{start:{line:18,column:15},end:{line:25,column:5}},"10":{start:{line:27,column:4},end:{line:35,column:44}},"11":{start:{line:29,column:12},end:{line:33,column:13}},"12":{start:{line:30,column:16},end:{line:30,column:27}},"13":{start:{line:32,column:16},end:{line:32,column:28}},"14":{start:{line:35,column:24},end:{line:35,column:42}},"15":{start:{line:36,column:4},end:{line:42,column:5}},"16":{start:{line:37,column:8},end:{line:37,column:36}},"17":{start:{line:39,column:8},end:{line:41,column:10}},"18":{start:{line:48,column:0},end:{line:71,column:3}},"19":{start:{line:50,column:15},end:{line:50,column:18}},"20":{start:{line:51,column:17},end:{line:51,column:34}},"21":{start:{line:53,column:4},end:{line:56,column:5}},"22":{start:{line:54,column:8},end:{line:54,column:49}},"23":{start:{line:55,column:8},end:{line:55,column:15}},"24":{start:{line:58,column:4},end:{line:58,column:34}},"25":{start:{line:60,column:4},end:{line:68,column:11}},"26":{start:{line:62,column:12},end:{line:62,column:23}},"27":{start:{line:63,column:12},end:{line:63,column:35}},"28":{start:{line:66,column:12},end:{line:66,column:31}},"29":{start:{line:67,column:12},end:{line:67,column:23}},"30":{start:{line:70,column:4},end:{line:70,column:32}},"31":{start:{line:76,column:0},end:{line:116,column:3}},"32":{start:{line:78,column:15},end:{line:78,column:18}},"33":{start:{line:79,column:16},end:{line:79,column:30}},"34":{start:{line:80,column:4},end:{line:80,column:36}},"35":{start:{line:81,column:19},end:{line:81,column:36}},"36":{start:{line:83,column:4},end:{line:91,column:11}},"37":{start:{line:85,column:12},end:{line:85,column:23}},"38":{start:{line:86,column:12},end:{line:86,column:35}},"39":{start:{line:89,column:12},end:{line:89,column:31}},"40":{start:{line:90,column:12},end:{line:90,column:23}},"41":{start:{line:92,column:4},end:{line:95,column:5}},"42":{start:{line:93,column:8},end:{line:93,column:79}},"43":{start:{line:94,column:8},end:{line:94,column:15}},"44":{start:{line:97,column:4},end:{line:106,column:11}},"45":{start:{line:100,column:12},end:{line:102,column:13}},"46":{start:{line:101,column:16},end:{line:101,column:27}},"47":{start:{line:105,column:12},end:{line:105,column:31}},"48":{start:{line:108,column:4},end:{line:111,column:5}},"49":{start:{line:109,column:8},end:{line:109,column:59}},"50":{start:{line:110,column:8},end:{line:110,column:15}},"51":{start:{line:113,column:4},end:{line:113,column:32}},"52":{start:{line:122,column:0},end:{line:122,column:24}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:8,column:17},end:{line:8,column:18}},loc:{start:{line:8,column:37},end:{line:43,column:1}},line:8},"1":{name:"(anonymous_1)",decl:{start:{line:28,column:14},end:{line:28,column:15}},loc:{start:{line:28,column:23},end:{line:34,column:9}},line:28},"2":{name:"(anonymous_2)",decl:{start:{line:35,column:15},end:{line:35,column:16}},loc:{start:{line:35,column:24},end:{line:35,column:42}},line:35},"3":{name:"(anonymous_3)",decl:{start:{line:48,column:23},end:{line:48,column:24}},loc:{start:{line:48,column:43},end:{line:71,column:1}},line:48},"4":{name:"(anonymous_4)",decl:{start:{line:61,column:14},end:{line:61,column:15}},loc:{start:{line:61,column:23},end:{line:64,column:9}},line:61},"5":{name:"(anonymous_5)",decl:{start:{line:65,column:15},end:{line:65,column:16}},loc:{start:{line:65,column:24},end:{line:68,column:9}},line:65},"6":{name:"(anonymous_6)",decl:{start:{line:76,column:22},end:{line:76,column:23}},loc:{start:{line:76,column:42},end:{line:116,column:1}},line:76},"7":{name:"(anonymous_7)",decl:{start:{line:84,column:14},end:{line:84,column:15}},loc:{start:{line:84,column:23},end:{line:87,column:9}},line:84},"8":{name:"(anonymous_8)",decl:{start:{line:88,column:15},end:{line:88,column:16}},loc:{start:{line:88,column:24},end:{line:91,column:9}},line:88},"9":{name:"(anonymous_9)",decl:{start:{line:99,column:14},end:{line:99,column:15}},loc:{start:{line:99,column:27},end:{line:103,column:9}},line:99},"10":{name:"(anonymous_10)",decl:{start:{line:104,column:15},end:{line:104,column:16}},loc:{start:{line:104,column:24},end:{line:106,column:9}},line:104}},branchMap:{"0":{loc:{start:{line:29,column:12},end:{line:33,column:13}},type:"if",locations:[{start:{line:29,column:12},end:{line:33,column:13}},{start:{line:29,column:12},end:{line:33,column:13}}],line:29},"1":{loc:{start:{line:36,column:4},end:{line:42,column:5}},type:"if",locations:[{start:{line:36,column:4},end:{line:42,column:5}},{start:{line:36,column:4},end:{line:42,column:5}}],line:36},"2":{loc:{start:{line:53,column:4},end:{line:56,column:5}},type:"if",locations:[{start:{line:53,column:4},end:{line:56,column:5}},{start:{line:53,column:4},end:{line:56,column:5}}],line:53},"3":{loc:{start:{line:63,column:19},end:{line:63,column:34}},type:"cond-expr",locations:[{start:{line:63,column:25},end:{line:63,column:28}},{start:{line:63,column:31},end:{line:63,column:34}}],line:63},"4":{loc:{start:{line:86,column:19},end:{line:86,column:34}},type:"cond-expr",locations:[{start:{line:86,column:25},end:{line:86,column:28}},{start:{line:86,column:31},end:{line:86,column:34}}],line:86},"5":{loc:{start:{line:92,column:4},end:{line:95,column:5}},type:"if",locations:[{start:{line:92,column:4},end:{line:95,column:5}},{start:{line:92,column:4},end:{line:95,column:5}}],line:92},"6":{loc:{start:{line:100,column:12},end:{line:102,column:13}},type:"if",locations:[{start:{line:100,column:12},end:{line:102,column:13}},{start:{line:100,column:12},end:{line:102,column:13}}],line:100},"7":{loc:{start:{line:108,column:4},end:{line:111,column:5}},type:"if",locations:[{start:{line:108,column:4},end:{line:111,column:5}},{start:{line:108,column:4},end:{line:111,column:5}}],line:108}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"2f722390bf019fa64b1f5ae8fcc94ab9fde9fbf1"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_zcw5eg62c=function(){return actualCoverage;};}return actualCoverage;}cov_zcw5eg62c();const express=(cov_zcw5eg62c().s[0]++,require("express"));const bcrypt=(cov_zcw5eg62c().s[1]++,require("bcrypt"));const router=(cov_zcw5eg62c().s[2]++,express.Router());const saltRounds=(cov_zcw5eg62c().s[3]++,12);// SECTION - CREATE USER
// Create a new user
cov_zcw5eg62c().s[4]++;router.post("/",async(req,res)=>{cov_zcw5eg62c().f[0]++;// TODO - Validation
let userInfo=(cov_zcw5eg62c().s[5]++,{email:req.body.email,hash:""});let code=(cov_zcw5eg62c().s[6]++,400);const hash=(cov_zcw5eg62c().s[7]++,bcrypt.hashSync(req.body.password,saltRounds));cov_zcw5eg62c().s[8]++;userInfo.hash=hash;let user=(cov_zcw5eg62c().s[9]++,{userinfo:userInfo,tasklists:[],preferences:[],tracks:[],goals:[],events:[]});cov_zcw5eg62c().s[10]++;await DB.insertUser(user).then(res=>{cov_zcw5eg62c().f[1]++;cov_zcw5eg62c().s[11]++;if(res==1){cov_zcw5eg62c().b[0][0]++;cov_zcw5eg62c().s[12]++;code=201;}else{cov_zcw5eg62c().b[0][1]++;cov_zcw5eg62c().s[13]++;code==500;}}).catch(err=>{cov_zcw5eg62c().f[2]++;cov_zcw5eg62c().s[14]++;return console.error(err);});cov_zcw5eg62c().s[15]++;if(code==201){cov_zcw5eg62c().b[1][0]++;cov_zcw5eg62c().s[16]++;res.status(code).send(user);}else{cov_zcw5eg62c().b[1][1]++;cov_zcw5eg62c().s[17]++;res.status(code).send("Unexpected error occured. Check Database connection");}});// !SECTION
// SECTION - FETCH USER
// Fetch an existing user
cov_zcw5eg62c().s[18]++;router.get("/:userid",async(req,res)=>{cov_zcw5eg62c().f[3]++;let user;let code=(cov_zcw5eg62c().s[19]++,400);let userid=(cov_zcw5eg62c().s[20]++,req.params.userid);cov_zcw5eg62c().s[21]++;if(userid.length!=24){cov_zcw5eg62c().b[2][0]++;cov_zcw5eg62c().s[22]++;res.status(code).send("invalid user id");cov_zcw5eg62c().s[23]++;return;}else{cov_zcw5eg62c().b[2][1]++;}cov_zcw5eg62c().s[24]++;userid=new ObjectID(userid);cov_zcw5eg62c().s[25]++;await DB.fetchUser(userid).then(res=>{cov_zcw5eg62c().f[4]++;cov_zcw5eg62c().s[26]++;user=res;cov_zcw5eg62c().s[27]++;code=res?(cov_zcw5eg62c().b[3][0]++,200):(cov_zcw5eg62c().b[3][1]++,400);}).catch(err=>{cov_zcw5eg62c().f[5]++;cov_zcw5eg62c().s[28]++;console.error(err);cov_zcw5eg62c().s[29]++;code=500;});cov_zcw5eg62c().s[30]++;res.status(code).send(user);});// !SECTION
// SECTION - FETCH USER
// Fetch an existing user
cov_zcw5eg62c().s[31]++;router.post("/login",async(req,res)=>{cov_zcw5eg62c().f[6]++;let user;let code=(cov_zcw5eg62c().s[32]++,200);let email=(cov_zcw5eg62c().s[33]++,req.body.email);cov_zcw5eg62c().s[34]++;email=email.replace(/ /g,"");// Strip white spaces
let password=(cov_zcw5eg62c().s[35]++,req.body.password);cov_zcw5eg62c().s[36]++;await DB.fetchUserByEmail(email).then(res=>{cov_zcw5eg62c().f[7]++;cov_zcw5eg62c().s[37]++;user=res;cov_zcw5eg62c().s[38]++;code=res?(cov_zcw5eg62c().b[4][0]++,200):(cov_zcw5eg62c().b[4][1]++,400);}).catch(err=>{cov_zcw5eg62c().f[8]++;cov_zcw5eg62c().s[39]++;console.error(err);cov_zcw5eg62c().s[40]++;code=500;});cov_zcw5eg62c().s[41]++;if(code==400){cov_zcw5eg62c().b[5][0]++;cov_zcw5eg62c().s[42]++;res.status(code).send("could not find a user with that email address");cov_zcw5eg62c().s[43]++;return;}else{cov_zcw5eg62c().b[5][1]++;}cov_zcw5eg62c().s[44]++;await bcrypt.compare(password,user.userinfo.hash).then(success=>{cov_zcw5eg62c().f[9]++;cov_zcw5eg62c().s[45]++;if(!success){cov_zcw5eg62c().b[6][0]++;cov_zcw5eg62c().s[46]++;code=403;}else{cov_zcw5eg62c().b[6][1]++;}}).catch(err=>{cov_zcw5eg62c().f[10]++;cov_zcw5eg62c().s[47]++;console.error(err);});cov_zcw5eg62c().s[48]++;if(code==403){cov_zcw5eg62c().b[7][0]++;cov_zcw5eg62c().s[49]++;res.status(code).send("invalid login credentials");cov_zcw5eg62c().s[50]++;return;}else{cov_zcw5eg62c().b[7][1]++;}cov_zcw5eg62c().s[51]++;res.status(code).send(user);// TODO - Make this more legitamate
// TODO - Make some tests
});// !SECTION
// TODO - Update Email
// TODO - Reset / Recover Password
cov_zcw5eg62c().s[52]++;module.exports=router;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInVzZXJzLmpzIl0sIm5hbWVzIjpbImV4cHJlc3MiLCJyZXF1aXJlIiwiYmNyeXB0Iiwicm91dGVyIiwiUm91dGVyIiwic2FsdFJvdW5kcyIsInBvc3QiLCJyZXEiLCJyZXMiLCJ1c2VySW5mbyIsImVtYWlsIiwiYm9keSIsImhhc2giLCJjb2RlIiwiaGFzaFN5bmMiLCJwYXNzd29yZCIsInVzZXIiLCJ1c2VyaW5mbyIsInRhc2tsaXN0cyIsInByZWZlcmVuY2VzIiwidHJhY2tzIiwiZ29hbHMiLCJldmVudHMiLCJEQiIsImluc2VydFVzZXIiLCJ0aGVuIiwiY2F0Y2giLCJlcnIiLCJjb25zb2xlIiwiZXJyb3IiLCJzdGF0dXMiLCJzZW5kIiwiZ2V0IiwidXNlcmlkIiwicGFyYW1zIiwibGVuZ3RoIiwiT2JqZWN0SUQiLCJmZXRjaFVzZXIiLCJyZXBsYWNlIiwiZmV0Y2hVc2VyQnlFbWFpbCIsImNvbXBhcmUiLCJzdWNjZXNzIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6ImdwT0FlWTt5RkFmWixLQUFNQSxDQUFBQSxPQUFPLHlCQUFHQyxPQUFPLENBQUMsU0FBRCxDQUFWLENBQWIsQ0FDQSxLQUFNQyxDQUFBQSxNQUFNLHlCQUFHRCxPQUFPLENBQUMsUUFBRCxDQUFWLENBQVosQ0FDQSxLQUFNRSxDQUFBQSxNQUFNLHlCQUFHSCxPQUFPLENBQUNJLE1BQVIsRUFBSCxDQUFaLENBQ0EsS0FBTUMsQ0FBQUEsVUFBVSx5QkFBRyxFQUFILENBQWhCLENBRUE7QUFDQTt1QkFDQUYsTUFBTSxDQUFDRyxJQUFQLENBQVksR0FBWixDQUFpQixNQUFPQyxHQUFQLENBQVlDLEdBQVosR0FBb0Isd0JBQ2pDO0FBQ0EsR0FBSUMsQ0FBQUEsUUFBUSx5QkFBRyxDQUNYQyxLQUFLLENBQUVILEdBQUcsQ0FBQ0ksSUFBSixDQUFTRCxLQURMLENBRVhFLElBQUksQ0FBRSxFQUZLLENBQUgsQ0FBWixDQUlBLEdBQUlDLENBQUFBLElBQUkseUJBQUcsR0FBSCxDQUFSLENBQ0EsS0FBTUQsQ0FBQUEsSUFBSSx5QkFBR1YsTUFBTSxDQUFDWSxRQUFQLENBQWdCUCxHQUFHLENBQUNJLElBQUosQ0FBU0ksUUFBekIsQ0FBbUNWLFVBQW5DLENBQUgsQ0FBVixDQVBpQyx1QkFRakNJLFFBQVEsQ0FBQ0csSUFBVCxDQUFnQkEsSUFBaEIsQ0FFQSxHQUFJSSxDQUFBQSxJQUFJLHlCQUFHLENBQ1BDLFFBQVEsQ0FBRVIsUUFESCxDQUVQUyxTQUFTLENBQUUsRUFGSixDQUdQQyxXQUFXLENBQUUsRUFITixDQUlQQyxNQUFNLENBQUUsRUFKRCxDQUtQQyxLQUFLLENBQUUsRUFMQSxDQU1QQyxNQUFNLENBQUUsRUFORCxDQUFILENBQVIsQ0FWaUMsd0JBbUJqQyxLQUFNQyxDQUFBQSxFQUFFLENBQUNDLFVBQUgsQ0FBY1IsSUFBZCxFQUNEUyxJQURDLENBQ0tqQixHQUFELEVBQVMsZ0RBQ1gsR0FBSUEsR0FBRyxFQUFJLENBQVgsQ0FBYyxtREFDVkssSUFBSSxDQUFHLEdBQVAsQ0FDSCxDQUZELElBRU8sbURBQ0hBLElBQUksRUFBSSxHQUFSLENBQ0gsQ0FDSixDQVBDLEVBUURhLEtBUkMsQ0FRTUMsR0FBRCxFQUFTLHNEQUFBQyxDQUFBQSxPQUFPLENBQUNDLEtBQVIsQ0FBY0YsR0FBZCxFQUFrQixDQVJoQyxDQUFOLENBbkJpQyx3QkE0QmpDLEdBQUlkLElBQUksRUFBSSxHQUFaLENBQWlCLG1EQUNiTCxHQUFHLENBQUNzQixNQUFKLENBQVdqQixJQUFYLEVBQWlCa0IsSUFBakIsQ0FBc0JmLElBQXRCLEVBQ0gsQ0FGRCxJQUVPLG1EQUNIUixHQUFHLENBQUNzQixNQUFKLENBQVdqQixJQUFYLEVBQWlCa0IsSUFBakIsQ0FDSSxxREFESixFQUdILENBQ0osQ0FuQ0QsRUFvQ0E7QUFFQTtBQUNBO3dCQUNBNUIsTUFBTSxDQUFDNkIsR0FBUCxDQUFXLFVBQVgsQ0FBdUIsTUFBT3pCLEdBQVAsQ0FBWUMsR0FBWixHQUFvQix3QkFDdkMsR0FBSVEsQ0FBQUEsSUFBSixDQUNBLEdBQUlILENBQUFBLElBQUksMEJBQUcsR0FBSCxDQUFSLENBQ0EsR0FBSW9CLENBQUFBLE1BQU0sMEJBQUcxQixHQUFHLENBQUMyQixNQUFKLENBQVdELE1BQWQsQ0FBVixDQUh1Qyx3QkFLdkMsR0FBSUEsTUFBTSxDQUFDRSxNQUFQLEVBQWlCLEVBQXJCLENBQXlCLG1EQUNyQjNCLEdBQUcsQ0FBQ3NCLE1BQUosQ0FBV2pCLElBQVgsRUFBaUJrQixJQUFqQixDQUFzQixpQkFBdEIsRUFEcUIsd0JBRXJCLE9BQ0gsQ0FIRCxnQ0FMdUMsd0JBVXZDRSxNQUFNLENBQUcsR0FBSUcsQ0FBQUEsUUFBSixDQUFhSCxNQUFiLENBQVQsQ0FWdUMsd0JBWXZDLEtBQU1WLENBQUFBLEVBQUUsQ0FBQ2MsU0FBSCxDQUFhSixNQUFiLEVBQ0RSLElBREMsQ0FDS2pCLEdBQUQsRUFBUyxnREFDWFEsSUFBSSxDQUFHUixHQUFQLENBRFcsd0JBRVhLLElBQUksQ0FBR0wsR0FBRyw0QkFBRyxHQUFILDZCQUFTLEdBQVQsQ0FBVixDQUNILENBSkMsRUFLRGtCLEtBTEMsQ0FLTUMsR0FBRCxFQUFTLGdEQUNaQyxPQUFPLENBQUNDLEtBQVIsQ0FBY0YsR0FBZCxFQURZLHdCQUVaZCxJQUFJLENBQUcsR0FBUCxDQUNILENBUkMsQ0FBTixDQVp1Qyx3QkFzQnZDTCxHQUFHLENBQUNzQixNQUFKLENBQVdqQixJQUFYLEVBQWlCa0IsSUFBakIsQ0FBc0JmLElBQXRCLEVBQ0gsQ0F2QkQsRUF3QkE7QUFFQTtBQUNBO3dCQUNBYixNQUFNLENBQUNHLElBQVAsQ0FBWSxRQUFaLENBQXNCLE1BQU9DLEdBQVAsQ0FBWUMsR0FBWixHQUFvQix3QkFDdEMsR0FBSVEsQ0FBQUEsSUFBSixDQUNBLEdBQUlILENBQUFBLElBQUksMEJBQUcsR0FBSCxDQUFSLENBQ0EsR0FBSUgsQ0FBQUEsS0FBSywwQkFBR0gsR0FBRyxDQUFDSSxJQUFKLENBQVNELEtBQVosQ0FBVCxDQUhzQyx3QkFJdENBLEtBQUssQ0FBR0EsS0FBSyxDQUFDNEIsT0FBTixDQUFjLElBQWQsQ0FBb0IsRUFBcEIsQ0FBUixDQUFpQztBQUNqQyxHQUFJdkIsQ0FBQUEsUUFBUSwwQkFBR1IsR0FBRyxDQUFDSSxJQUFKLENBQVNJLFFBQVosQ0FBWixDQUxzQyx3QkFPdEMsS0FBTVEsQ0FBQUEsRUFBRSxDQUFDZ0IsZ0JBQUgsQ0FBb0I3QixLQUFwQixFQUNEZSxJQURDLENBQ0tqQixHQUFELEVBQVMsZ0RBQ1hRLElBQUksQ0FBR1IsR0FBUCxDQURXLHdCQUVYSyxJQUFJLENBQUdMLEdBQUcsNEJBQUcsR0FBSCw2QkFBUyxHQUFULENBQVYsQ0FDSCxDQUpDLEVBS0RrQixLQUxDLENBS01DLEdBQUQsRUFBUyxnREFDWkMsT0FBTyxDQUFDQyxLQUFSLENBQWNGLEdBQWQsRUFEWSx3QkFFWmQsSUFBSSxDQUFHLEdBQVAsQ0FDSCxDQVJDLENBQU4sQ0FQc0Msd0JBZ0J0QyxHQUFJQSxJQUFJLEVBQUksR0FBWixDQUFpQixtREFDYkwsR0FBRyxDQUFDc0IsTUFBSixDQUFXakIsSUFBWCxFQUFpQmtCLElBQWpCLENBQXNCLCtDQUF0QixFQURhLHdCQUViLE9BQ0gsQ0FIRCxnQ0FoQnNDLHdCQXFCdEMsS0FBTTdCLENBQUFBLE1BQU0sQ0FDUHNDLE9BREMsQ0FDT3pCLFFBRFAsQ0FDaUJDLElBQUksQ0FBQ0MsUUFBTCxDQUFjTCxJQUQvQixFQUVEYSxJQUZDLENBRUtnQixPQUFELEVBQWEsZ0RBQ2YsR0FBSSxDQUFDQSxPQUFMLENBQWMsbURBQ1Y1QixJQUFJLENBQUcsR0FBUCxDQUNILENBRkQsZ0NBR0gsQ0FOQyxFQU9EYSxLQVBDLENBT01DLEdBQUQsRUFBUyxpREFDWkMsT0FBTyxDQUFDQyxLQUFSLENBQWNGLEdBQWQsRUFDSCxDQVRDLENBQU4sQ0FyQnNDLHdCQWdDdEMsR0FBSWQsSUFBSSxFQUFJLEdBQVosQ0FBaUIsbURBQ2JMLEdBQUcsQ0FBQ3NCLE1BQUosQ0FBV2pCLElBQVgsRUFBaUJrQixJQUFqQixDQUFzQiwyQkFBdEIsRUFEYSx3QkFFYixPQUNILENBSEQsZ0NBaENzQyx3QkFxQ3RDdkIsR0FBRyxDQUFDc0IsTUFBSixDQUFXakIsSUFBWCxFQUFpQmtCLElBQWpCLENBQXNCZixJQUF0QixFQUNBO0FBQ0E7QUFDSCxDQXhDRCxFQXlDQTtBQUVBO0FBQ0E7d0JBRUEwQixNQUFNLENBQUNDLE9BQVAsQ0FBaUJ4QyxNQUFqQiIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGV4cHJlc3MgPSByZXF1aXJlKFwiZXhwcmVzc1wiKTtcclxuY29uc3QgYmNyeXB0ID0gcmVxdWlyZShcImJjcnlwdFwiKTtcclxuY29uc3Qgcm91dGVyID0gZXhwcmVzcy5Sb3V0ZXIoKTtcclxuY29uc3Qgc2FsdFJvdW5kcyA9IDEyO1xyXG5cclxuLy8gU0VDVElPTiAtIENSRUFURSBVU0VSXHJcbi8vIENyZWF0ZSBhIG5ldyB1c2VyXHJcbnJvdXRlci5wb3N0KFwiL1wiLCBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICAgIC8vIFRPRE8gLSBWYWxpZGF0aW9uXHJcbiAgICBsZXQgdXNlckluZm8gPSB7XHJcbiAgICAgICAgZW1haWw6IHJlcS5ib2R5LmVtYWlsLFxyXG4gICAgICAgIGhhc2g6IFwiXCIsXHJcbiAgICB9O1xyXG4gICAgbGV0IGNvZGUgPSA0MDA7XHJcbiAgICBjb25zdCBoYXNoID0gYmNyeXB0Lmhhc2hTeW5jKHJlcS5ib2R5LnBhc3N3b3JkLCBzYWx0Um91bmRzKTtcclxuICAgIHVzZXJJbmZvLmhhc2ggPSBoYXNoO1xyXG5cclxuICAgIGxldCB1c2VyID0ge1xyXG4gICAgICAgIHVzZXJpbmZvOiB1c2VySW5mbyxcclxuICAgICAgICB0YXNrbGlzdHM6IFtdLFxyXG4gICAgICAgIHByZWZlcmVuY2VzOiBbXSxcclxuICAgICAgICB0cmFja3M6IFtdLFxyXG4gICAgICAgIGdvYWxzOiBbXSxcclxuICAgICAgICBldmVudHM6IFtdLFxyXG4gICAgfTtcclxuXHJcbiAgICBhd2FpdCBEQi5pbnNlcnRVc2VyKHVzZXIpXHJcbiAgICAgICAgLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgICAgICAgICBpZiAocmVzID09IDEpIHtcclxuICAgICAgICAgICAgICAgIGNvZGUgPSAyMDE7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBjb2RlID09IDUwMDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLmNhdGNoKChlcnIpID0+IGNvbnNvbGUuZXJyb3IoZXJyKSk7XHJcbiAgICBpZiAoY29kZSA9PSAyMDEpIHtcclxuICAgICAgICByZXMuc3RhdHVzKGNvZGUpLnNlbmQodXNlcik7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJlcy5zdGF0dXMoY29kZSkuc2VuZChcclxuICAgICAgICAgICAgXCJVbmV4cGVjdGVkIGVycm9yIG9jY3VyZWQuIENoZWNrIERhdGFiYXNlIGNvbm5lY3Rpb25cIlxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcbn0pO1xyXG4vLyAhU0VDVElPTlxyXG5cclxuLy8gU0VDVElPTiAtIEZFVENIIFVTRVJcclxuLy8gRmV0Y2ggYW4gZXhpc3RpbmcgdXNlclxyXG5yb3V0ZXIuZ2V0KFwiLzp1c2VyaWRcIiwgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgICBsZXQgdXNlcjtcclxuICAgIGxldCBjb2RlID0gNDAwO1xyXG4gICAgbGV0IHVzZXJpZCA9IHJlcS5wYXJhbXMudXNlcmlkO1xyXG5cclxuICAgIGlmICh1c2VyaWQubGVuZ3RoICE9IDI0KSB7XHJcbiAgICAgICAgcmVzLnN0YXR1cyhjb2RlKS5zZW5kKFwiaW52YWxpZCB1c2VyIGlkXCIpO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICB1c2VyaWQgPSBuZXcgT2JqZWN0SUQodXNlcmlkKTtcclxuXHJcbiAgICBhd2FpdCBEQi5mZXRjaFVzZXIodXNlcmlkKVxyXG4gICAgICAgIC50aGVuKChyZXMpID0+IHtcclxuICAgICAgICAgICAgdXNlciA9IHJlcztcclxuICAgICAgICAgICAgY29kZSA9IHJlcyA/IDIwMCA6IDQwMDtcclxuICAgICAgICB9KVxyXG4gICAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcclxuICAgICAgICAgICAgY29kZSA9IDUwMDtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICByZXMuc3RhdHVzKGNvZGUpLnNlbmQodXNlcik7XHJcbn0pO1xyXG4vLyAhU0VDVElPTlxyXG5cclxuLy8gU0VDVElPTiAtIEZFVENIIFVTRVJcclxuLy8gRmV0Y2ggYW4gZXhpc3RpbmcgdXNlclxyXG5yb3V0ZXIucG9zdChcIi9sb2dpblwiLCBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICAgIGxldCB1c2VyO1xyXG4gICAgbGV0IGNvZGUgPSAyMDA7XHJcbiAgICBsZXQgZW1haWwgPSByZXEuYm9keS5lbWFpbDtcclxuICAgIGVtYWlsID0gZW1haWwucmVwbGFjZSgvIC9nLCBcIlwiKTsgLy8gU3RyaXAgd2hpdGUgc3BhY2VzXHJcbiAgICBsZXQgcGFzc3dvcmQgPSByZXEuYm9keS5wYXNzd29yZDtcclxuXHJcbiAgICBhd2FpdCBEQi5mZXRjaFVzZXJCeUVtYWlsKGVtYWlsKVxyXG4gICAgICAgIC50aGVuKChyZXMpID0+IHtcclxuICAgICAgICAgICAgdXNlciA9IHJlcztcclxuICAgICAgICAgICAgY29kZSA9IHJlcyA/IDIwMCA6IDQwMDtcclxuICAgICAgICB9KVxyXG4gICAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcclxuICAgICAgICAgICAgY29kZSA9IDUwMDtcclxuICAgICAgICB9KTtcclxuICAgIGlmIChjb2RlID09IDQwMCkge1xyXG4gICAgICAgIHJlcy5zdGF0dXMoY29kZSkuc2VuZChcImNvdWxkIG5vdCBmaW5kIGEgdXNlciB3aXRoIHRoYXQgZW1haWwgYWRkcmVzc1wiKTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgYXdhaXQgYmNyeXB0XHJcbiAgICAgICAgLmNvbXBhcmUocGFzc3dvcmQsIHVzZXIudXNlcmluZm8uaGFzaClcclxuICAgICAgICAudGhlbigoc3VjY2VzcykgPT4ge1xyXG4gICAgICAgICAgICBpZiAoIXN1Y2Nlc3MpIHtcclxuICAgICAgICAgICAgICAgIGNvZGUgPSA0MDM7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG4gICAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICBpZiAoY29kZSA9PSA0MDMpIHtcclxuICAgICAgICByZXMuc3RhdHVzKGNvZGUpLnNlbmQoXCJpbnZhbGlkIGxvZ2luIGNyZWRlbnRpYWxzXCIpO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICByZXMuc3RhdHVzKGNvZGUpLnNlbmQodXNlcik7XHJcbiAgICAvLyBUT0RPIC0gTWFrZSB0aGlzIG1vcmUgbGVnaXRhbWF0ZVxyXG4gICAgLy8gVE9ETyAtIE1ha2Ugc29tZSB0ZXN0c1xyXG59KTtcclxuLy8gIVNFQ1RJT05cclxuXHJcbi8vIFRPRE8gLSBVcGRhdGUgRW1haWxcclxuLy8gVE9ETyAtIFJlc2V0IC8gUmVjb3ZlciBQYXNzd29yZFxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSByb3V0ZXI7XHJcbiJdfQ==