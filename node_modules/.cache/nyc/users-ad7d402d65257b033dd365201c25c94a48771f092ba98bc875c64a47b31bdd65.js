function cov_zcw5eg62c(){var path="C:\\Users\\peter\\Desktop\\Files\\perhail\\server\\routes\\users.js";var hash="a8cac50af094fcc5bb8d4986278119c26dad6b77";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"C:\\Users\\peter\\Desktop\\Files\\perhail\\server\\routes\\users.js",statementMap:{"0":{start:{line:1,column:16},end:{line:1,column:34}},"1":{start:{line:2,column:15},end:{line:2,column:32}},"2":{start:{line:3,column:15},end:{line:3,column:31}},"3":{start:{line:4,column:19},end:{line:4,column:21}},"4":{start:{line:5,column:13},end:{line:5,column:28}},"5":{start:{line:6,column:15},end:{line:6,column:42}},"6":{start:{line:7,column:11},end:{line:7,column:73}},"7":{start:{line:8,column:33},end:{line:8,column:58}},"8":{start:{line:12,column:0},end:{line:47,column:3}},"9":{start:{line:14,column:19},end:{line:17,column:5}},"10":{start:{line:18,column:15},end:{line:18,column:18}},"11":{start:{line:19,column:17},end:{line:19,column:63}},"12":{start:{line:20,column:4},end:{line:20,column:25}},"13":{start:{line:22,column:15},end:{line:29,column:5}},"14":{start:{line:31,column:4},end:{line:39,column:44}},"15":{start:{line:33,column:12},end:{line:37,column:13}},"16":{start:{line:34,column:16},end:{line:34,column:27}},"17":{start:{line:36,column:16},end:{line:36,column:28}},"18":{start:{line:39,column:24},end:{line:39,column:42}},"19":{start:{line:40,column:4},end:{line:46,column:5}},"20":{start:{line:41,column:8},end:{line:41,column:36}},"21":{start:{line:43,column:8},end:{line:45,column:10}},"22":{start:{line:52,column:0},end:{line:75,column:3}},"23":{start:{line:54,column:15},end:{line:54,column:18}},"24":{start:{line:55,column:17},end:{line:55,column:34}},"25":{start:{line:57,column:4},end:{line:60,column:5}},"26":{start:{line:58,column:8},end:{line:58,column:49}},"27":{start:{line:59,column:8},end:{line:59,column:15}},"28":{start:{line:62,column:4},end:{line:62,column:34}},"29":{start:{line:64,column:4},end:{line:72,column:11}},"30":{start:{line:66,column:12},end:{line:66,column:23}},"31":{start:{line:67,column:12},end:{line:67,column:35}},"32":{start:{line:70,column:12},end:{line:70,column:31}},"33":{start:{line:71,column:12},end:{line:71,column:23}},"34":{start:{line:74,column:4},end:{line:74,column:32}},"35":{start:{line:79,column:0},end:{line:79,column:49}},"36":{start:{line:83,column:0},end:{line:123,column:3}},"37":{start:{line:85,column:15},end:{line:85,column:18}},"38":{start:{line:86,column:16},end:{line:86,column:30}},"39":{start:{line:87,column:4},end:{line:87,column:36}},"40":{start:{line:88,column:19},end:{line:88,column:36}},"41":{start:{line:90,column:4},end:{line:98,column:11}},"42":{start:{line:92,column:12},end:{line:92,column:23}},"43":{start:{line:93,column:12},end:{line:93,column:35}},"44":{start:{line:96,column:12},end:{line:96,column:31}},"45":{start:{line:97,column:12},end:{line:97,column:23}},"46":{start:{line:99,column:4},end:{line:102,column:5}},"47":{start:{line:100,column:8},end:{line:100,column:79}},"48":{start:{line:101,column:8},end:{line:101,column:15}},"49":{start:{line:104,column:4},end:{line:113,column:11}},"50":{start:{line:107,column:12},end:{line:109,column:13}},"51":{start:{line:108,column:16},end:{line:108,column:27}},"52":{start:{line:112,column:12},end:{line:112,column:31}},"53":{start:{line:115,column:4},end:{line:118,column:5}},"54":{start:{line:116,column:8},end:{line:116,column:59}},"55":{start:{line:117,column:8},end:{line:117,column:15}},"56":{start:{line:120,column:4},end:{line:120,column:32}},"57":{start:{line:129,column:0},end:{line:129,column:24}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:12,column:17},end:{line:12,column:18}},loc:{start:{line:12,column:37},end:{line:47,column:1}},line:12},"1":{name:"(anonymous_1)",decl:{start:{line:32,column:14},end:{line:32,column:15}},loc:{start:{line:32,column:23},end:{line:38,column:9}},line:32},"2":{name:"(anonymous_2)",decl:{start:{line:39,column:15},end:{line:39,column:16}},loc:{start:{line:39,column:24},end:{line:39,column:42}},line:39},"3":{name:"(anonymous_3)",decl:{start:{line:52,column:23},end:{line:52,column:24}},loc:{start:{line:52,column:43},end:{line:75,column:1}},line:52},"4":{name:"(anonymous_4)",decl:{start:{line:65,column:14},end:{line:65,column:15}},loc:{start:{line:65,column:23},end:{line:68,column:9}},line:65},"5":{name:"(anonymous_5)",decl:{start:{line:69,column:15},end:{line:69,column:16}},loc:{start:{line:69,column:24},end:{line:72,column:9}},line:69},"6":{name:"(anonymous_6)",decl:{start:{line:79,column:25},end:{line:79,column:26}},loc:{start:{line:79,column:45},end:{line:79,column:47}},line:79},"7":{name:"(anonymous_7)",decl:{start:{line:83,column:22},end:{line:83,column:23}},loc:{start:{line:83,column:42},end:{line:123,column:1}},line:83},"8":{name:"(anonymous_8)",decl:{start:{line:91,column:14},end:{line:91,column:15}},loc:{start:{line:91,column:23},end:{line:94,column:9}},line:91},"9":{name:"(anonymous_9)",decl:{start:{line:95,column:15},end:{line:95,column:16}},loc:{start:{line:95,column:24},end:{line:98,column:9}},line:95},"10":{name:"(anonymous_10)",decl:{start:{line:106,column:14},end:{line:106,column:15}},loc:{start:{line:106,column:27},end:{line:110,column:9}},line:106},"11":{name:"(anonymous_11)",decl:{start:{line:111,column:15},end:{line:111,column:16}},loc:{start:{line:111,column:24},end:{line:113,column:9}},line:111}},branchMap:{"0":{loc:{start:{line:33,column:12},end:{line:37,column:13}},type:"if",locations:[{start:{line:33,column:12},end:{line:37,column:13}},{start:{line:33,column:12},end:{line:37,column:13}}],line:33},"1":{loc:{start:{line:40,column:4},end:{line:46,column:5}},type:"if",locations:[{start:{line:40,column:4},end:{line:46,column:5}},{start:{line:40,column:4},end:{line:46,column:5}}],line:40},"2":{loc:{start:{line:57,column:4},end:{line:60,column:5}},type:"if",locations:[{start:{line:57,column:4},end:{line:60,column:5}},{start:{line:57,column:4},end:{line:60,column:5}}],line:57},"3":{loc:{start:{line:67,column:19},end:{line:67,column:34}},type:"cond-expr",locations:[{start:{line:67,column:25},end:{line:67,column:28}},{start:{line:67,column:31},end:{line:67,column:34}}],line:67},"4":{loc:{start:{line:93,column:19},end:{line:93,column:34}},type:"cond-expr",locations:[{start:{line:93,column:25},end:{line:93,column:28}},{start:{line:93,column:31},end:{line:93,column:34}}],line:93},"5":{loc:{start:{line:99,column:4},end:{line:102,column:5}},type:"if",locations:[{start:{line:99,column:4},end:{line:102,column:5}},{start:{line:99,column:4},end:{line:102,column:5}}],line:99},"6":{loc:{start:{line:107,column:12},end:{line:109,column:13}},type:"if",locations:[{start:{line:107,column:12},end:{line:109,column:13}},{start:{line:107,column:12},end:{line:109,column:13}}],line:107},"7":{loc:{start:{line:115,column:4},end:{line:118,column:5}},type:"if",locations:[{start:{line:115,column:4},end:{line:118,column:5}},{start:{line:115,column:4},end:{line:118,column:5}}],line:115}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"a8cac50af094fcc5bb8d4986278119c26dad6b77"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_zcw5eg62c=function(){return actualCoverage;};}return actualCoverage;}cov_zcw5eg62c();const express=(cov_zcw5eg62c().s[0]++,require("express"));const bcrypt=(cov_zcw5eg62c().s[1]++,require("bcrypt"));const router=(cov_zcw5eg62c().s[2]++,express.Router());const saltRounds=(cov_zcw5eg62c().s[3]++,12);const path=(cov_zcw5eg62c().s[4]++,require("path"));let ObjectID=(cov_zcw5eg62c().s[5]++,require("mongodb").ObjectID);const DB=(cov_zcw5eg62c().s[6]++,require(path.join(__dirname,"../","modules","database.js")));const{initSession,isEmail}=(cov_zcw5eg62c().s[7]++,require("../utils/utils"));// SECTION - CREATE USER
// Create a new user
cov_zcw5eg62c().s[8]++;router.post("/",async(req,res)=>{cov_zcw5eg62c().f[0]++;// TODO - Validation
let userInfo=(cov_zcw5eg62c().s[9]++,{email:req.body.email,hash:""});let code=(cov_zcw5eg62c().s[10]++,400);const hash=(cov_zcw5eg62c().s[11]++,bcrypt.hashSync(req.body.password,saltRounds));cov_zcw5eg62c().s[12]++;userInfo.hash=hash;let user=(cov_zcw5eg62c().s[13]++,{userinfo:userInfo,tasklists:[],preferences:[],tracks:[],goals:[],events:[]});cov_zcw5eg62c().s[14]++;await DB.insertUser(user).then(res=>{cov_zcw5eg62c().f[1]++;cov_zcw5eg62c().s[15]++;if(res==1){cov_zcw5eg62c().b[0][0]++;cov_zcw5eg62c().s[16]++;code=201;}else{cov_zcw5eg62c().b[0][1]++;cov_zcw5eg62c().s[17]++;code==500;}}).catch(err=>{cov_zcw5eg62c().f[2]++;cov_zcw5eg62c().s[18]++;return console.error(err);});cov_zcw5eg62c().s[19]++;if(code==201){cov_zcw5eg62c().b[1][0]++;cov_zcw5eg62c().s[20]++;res.status(code).send(user);}else{cov_zcw5eg62c().b[1][1]++;cov_zcw5eg62c().s[21]++;res.status(code).send("Unexpected error occured. Check Database connection");}});// !SECTION
// SECTION - FETCH USER
// Fetch an existing user
cov_zcw5eg62c().s[22]++;router.get("/:userid",async(req,res)=>{cov_zcw5eg62c().f[3]++;let user;let code=(cov_zcw5eg62c().s[23]++,400);let userid=(cov_zcw5eg62c().s[24]++,req.params.userid);cov_zcw5eg62c().s[25]++;if(userid.length!=24){cov_zcw5eg62c().b[2][0]++;cov_zcw5eg62c().s[26]++;res.status(code).send("invalid user id");cov_zcw5eg62c().s[27]++;return;}else{cov_zcw5eg62c().b[2][1]++;}cov_zcw5eg62c().s[28]++;userid=new ObjectID(userid);cov_zcw5eg62c().s[29]++;await DB.fetchUser(userid).then(res=>{cov_zcw5eg62c().f[4]++;cov_zcw5eg62c().s[30]++;user=res;cov_zcw5eg62c().s[31]++;code=res?(cov_zcw5eg62c().b[3][0]++,200):(cov_zcw5eg62c().b[3][1]++,400);}).catch(err=>{cov_zcw5eg62c().f[5]++;cov_zcw5eg62c().s[32]++;console.error(err);cov_zcw5eg62c().s[33]++;code=500;});cov_zcw5eg62c().s[34]++;res.status(code).send(user);});// !SECTION
// SECTION - RESGISTER USER
cov_zcw5eg62c().s[35]++;router.post("/register",async(req,res)=>{cov_zcw5eg62c().f[6]++;});// SECTION - LOGIN USER
// Login a user
cov_zcw5eg62c().s[36]++;router.post("/login",async(req,res)=>{cov_zcw5eg62c().f[7]++;let user;let code=(cov_zcw5eg62c().s[37]++,200);let email=(cov_zcw5eg62c().s[38]++,req.body.email);cov_zcw5eg62c().s[39]++;email=email.replace(/ /g,"");// Strip white spaces
let password=(cov_zcw5eg62c().s[40]++,req.body.password);cov_zcw5eg62c().s[41]++;await DB.fetchUserByEmail(email).then(res=>{cov_zcw5eg62c().f[8]++;cov_zcw5eg62c().s[42]++;user=res;cov_zcw5eg62c().s[43]++;code=res?(cov_zcw5eg62c().b[4][0]++,200):(cov_zcw5eg62c().b[4][1]++,400);}).catch(err=>{cov_zcw5eg62c().f[9]++;cov_zcw5eg62c().s[44]++;console.error(err);cov_zcw5eg62c().s[45]++;code=500;});cov_zcw5eg62c().s[46]++;if(code==400){cov_zcw5eg62c().b[5][0]++;cov_zcw5eg62c().s[47]++;res.status(code).send("could not find a user with that email address");cov_zcw5eg62c().s[48]++;return;}else{cov_zcw5eg62c().b[5][1]++;}cov_zcw5eg62c().s[49]++;await bcrypt.compare(password,user.userinfo.hash).then(success=>{cov_zcw5eg62c().f[10]++;cov_zcw5eg62c().s[50]++;if(!success){cov_zcw5eg62c().b[6][0]++;cov_zcw5eg62c().s[51]++;code=403;}else{cov_zcw5eg62c().b[6][1]++;}}).catch(err=>{cov_zcw5eg62c().f[11]++;cov_zcw5eg62c().s[52]++;console.error(err);});cov_zcw5eg62c().s[53]++;if(code==403){cov_zcw5eg62c().b[7][0]++;cov_zcw5eg62c().s[54]++;res.status(code).send("invalid login credentials");cov_zcw5eg62c().s[55]++;return;}else{cov_zcw5eg62c().b[7][1]++;}cov_zcw5eg62c().s[56]++;res.status(code).send(user);// TODO - Make this more legitamate
// TODO - Make some tests
});// !SECTION
// TODO - Update Email
// TODO - Reset / Recover Password
cov_zcw5eg62c().s[57]++;module.exports=router;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInVzZXJzLmpzIl0sIm5hbWVzIjpbImV4cHJlc3MiLCJyZXF1aXJlIiwiYmNyeXB0Iiwicm91dGVyIiwiUm91dGVyIiwic2FsdFJvdW5kcyIsInBhdGgiLCJPYmplY3RJRCIsIkRCIiwiam9pbiIsIl9fZGlybmFtZSIsImluaXRTZXNzaW9uIiwiaXNFbWFpbCIsInBvc3QiLCJyZXEiLCJyZXMiLCJ1c2VySW5mbyIsImVtYWlsIiwiYm9keSIsImhhc2giLCJjb2RlIiwiaGFzaFN5bmMiLCJwYXNzd29yZCIsInVzZXIiLCJ1c2VyaW5mbyIsInRhc2tsaXN0cyIsInByZWZlcmVuY2VzIiwidHJhY2tzIiwiZ29hbHMiLCJldmVudHMiLCJpbnNlcnRVc2VyIiwidGhlbiIsImNhdGNoIiwiZXJyIiwiY29uc29sZSIsImVycm9yIiwic3RhdHVzIiwic2VuZCIsImdldCIsInVzZXJpZCIsInBhcmFtcyIsImxlbmd0aCIsImZldGNoVXNlciIsInJlcGxhY2UiLCJmZXRjaFVzZXJCeUVtYWlsIiwiY29tcGFyZSIsInN1Y2Nlc3MiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoic25QQWVZO3lGQWZaLEtBQU1BLENBQUFBLE9BQU8seUJBQUdDLE9BQU8sQ0FBQyxTQUFELENBQVYsQ0FBYixDQUNBLEtBQU1DLENBQUFBLE1BQU0seUJBQUdELE9BQU8sQ0FBQyxRQUFELENBQVYsQ0FBWixDQUNBLEtBQU1FLENBQUFBLE1BQU0seUJBQUdILE9BQU8sQ0FBQ0ksTUFBUixFQUFILENBQVosQ0FDQSxLQUFNQyxDQUFBQSxVQUFVLHlCQUFHLEVBQUgsQ0FBaEIsQ0FDQSxLQUFNQyxDQUFBQSxJQUFJLHlCQUFHTCxPQUFPLENBQUMsTUFBRCxDQUFWLENBQVYsQ0FDQSxHQUFJTSxDQUFBQSxRQUFRLHlCQUFHTixPQUFPLENBQUMsU0FBRCxDQUFQLENBQW1CTSxRQUF0QixDQUFaLENBQ0EsS0FBTUMsQ0FBQUEsRUFBRSx5QkFBR1AsT0FBTyxDQUFDSyxJQUFJLENBQUNHLElB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LElBQWpCLENBQXNCLCtDQUF0QixFQURhLHdCQUViLE9BQ0gsQ0FIRCxnQ0FoQnNDLHdCQXFCdEMsS0FBTW5DLENBQUFBLE1BQU0sQ0FDUDJDLE9BREMsQ0FDT3ZCLFFBRFAsQ0FDaUJDLElBQUksQ0FBQ0MsUUFBTCxDQUFjTCxJQUQvQixFQUVEWSxJQUZDLENBRUtlLE9BQUQsRUFBYSxpREFDZixHQUFJLENBQUNBLE9BQUwsQ0FBYyxtREFDVjFCLElBQUksQ0FBRyxHQUFQLENBQ0gsQ0FGRCxnQ0FHSCxDQU5DLEVBT0RZLEtBUEMsQ0FPTUMsR0FBRCxFQUFTLGlEQUNaQyxPQUFPLENBQUNDLEtBQVIsQ0FBY0YsR0FBZCxFQUNILENBVEMsQ0FBTixDQXJCc0Msd0JBZ0N0QyxHQUFJYixJQUFJLEVBQUksR0FBWixDQUFpQixtREFDYkwsR0FBRyxDQUFDcUIsTUFBSixDQUFXaEIsSUFBWCxFQUFpQmlCLElBQWpCLENBQXNCLDJCQUF0QixFQURhLHdCQUViLE9BQ0gsQ0FIRCxnQ0FoQ3NDLHdCQXFDdEN0QixHQUFHLENBQUNxQixNQUFKLENBQVdoQixJQUFYLEVBQWlCaUIsSUFBakIsQ0FBc0JkLElBQXRCLEVBQ0E7QUFDQTtBQUNILENBeENELEVBeUNBO0FBRUE7QUFDQTt3QkFFQXdCLE1BQU0sQ0FBQ0MsT0FBUCxDQUFpQjdDLE1BQWpCIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgZXhwcmVzcyA9IHJlcXVpcmUoXCJleHByZXNzXCIpO1xyXG5jb25zdCBiY3J5cHQgPSByZXF1aXJlKFwiYmNyeXB0XCIpO1xyXG5jb25zdCByb3V0ZXIgPSBleHByZXNzLlJvdXRlcigpO1xyXG5jb25zdCBzYWx0Um91bmRzID0gMTI7XHJcbmNvbnN0IHBhdGggPSByZXF1aXJlKFwicGF0aFwiKTtcclxubGV0IE9iamVjdElEID0gcmVxdWlyZShcIm1vbmdvZGJcIikuT2JqZWN0SUQ7XHJcbmNvbnN0IERCID0gcmVxdWlyZShwYXRoLmpvaW4oX19kaXJuYW1lLCBcIi4uL1wiLCBcIm1vZHVsZXNcIiwgXCJkYXRhYmFzZS5qc1wiKSk7XHJcbmNvbnN0IHsgaW5pdFNlc3Npb24sIGlzRW1haWwgfSA9IHJlcXVpcmUoXCIuLi91dGlscy91dGlsc1wiKTtcclxuXHJcbi8vIFNFQ1RJT04gLSBDUkVBVEUgVVNFUlxyXG4vLyBDcmVhdGUgYSBuZXcgdXNlclxyXG5yb3V0ZXIucG9zdChcIi9cIiwgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgICAvLyBUT0RPIC0gVmFsaWRhdGlvblxyXG4gICAgbGV0IHVzZXJJbmZvID0ge1xyXG4gICAgICAgIGVtYWlsOiByZXEuYm9keS5lbWFpbCxcclxuICAgICAgICBoYXNoOiBcIlwiLFxyXG4gICAgfTtcclxuICAgIGxldCBjb2RlID0gNDAwO1xyXG4gICAgY29uc3QgaGFzaCA9IGJjcnlwdC5oYXNoU3luYyhyZXEuYm9keS5wYXNzd29yZCwgc2FsdFJvdW5kcyk7XHJcbiAgICB1c2VySW5mby5oYXNoID0gaGFzaDtcclxuXHJcbiAgICBsZXQgdXNlciA9IHtcclxuICAgICAgICB1c2VyaW5mbzogdXNlckluZm8sXHJcbiAgICAgICAgdGFza2xpc3RzOiBbXSxcclxuICAgICAgICBwcmVmZXJlbmNlczogW10sXHJcbiAgICAgICAgdHJhY2tzOiBbXSxcclxuICAgICAgICBnb2FsczogW10sXHJcbiAgICAgICAgZXZlbnRzOiBbXSxcclxuICAgIH07XHJcblxyXG4gICAgYXdhaXQgREIuaW5zZXJ0VXNlcih1c2VyKVxyXG4gICAgICAgIC50aGVuKChyZXMpID0+IHtcclxuICAgICAgICAgICAgaWYgKHJlcyA9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICBjb2RlID0gMjAxO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgY29kZSA9PSA1MDA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG4gICAgICAgIC5jYXRjaCgoZXJyKSA9PiBjb25zb2xlLmVycm9yKGVycikpO1xyXG4gICAgaWYgKGNvZGUgPT0gMjAxKSB7XHJcbiAgICAgICAgcmVzLnN0YXR1cyhjb2RlKS5zZW5kKHVzZXIpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICByZXMuc3RhdHVzKGNvZGUpLnNlbmQoXHJcbiAgICAgICAgICAgIFwiVW5leHBlY3RlZCBlcnJvciBvY2N1cmVkLiBDaGVjayBEYXRhYmFzZSBjb25uZWN0aW9uXCJcclxuICAgICAgICApO1xyXG4gICAgfVxyXG59KTtcclxuLy8gIVNFQ1RJT05cclxuXHJcbi8vIFNFQ1RJT04gLSBGRVRDSCBVU0VSXHJcbi8vIEZldGNoIGFuIGV4aXN0aW5nIHVzZXJcclxucm91dGVyLmdldChcIi86dXNlcmlkXCIsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xyXG4gICAgbGV0IHVzZXI7XHJcbiAgICBsZXQgY29kZSA9IDQwMDtcclxuICAgIGxldCB1c2VyaWQgPSByZXEucGFyYW1zLnVzZXJpZDtcclxuXHJcbiAgICBpZiAodXNlcmlkLmxlbmd0aCAhPSAyNCkge1xyXG4gICAgICAgIHJlcy5zdGF0dXMoY29kZSkuc2VuZChcImludmFsaWQgdXNlciBpZFwiKTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgdXNlcmlkID0gbmV3IE9iamVjdElEKHVzZXJpZCk7XHJcblxyXG4gICAgYXdhaXQgREIuZmV0Y2hVc2VyKHVzZXJpZClcclxuICAgICAgICAudGhlbigocmVzKSA9PiB7XHJcbiAgICAgICAgICAgIHVzZXIgPSByZXM7XHJcbiAgICAgICAgICAgIGNvZGUgPSByZXMgPyAyMDAgOiA0MDA7XHJcbiAgICAgICAgfSlcclxuICAgICAgICAuY2F0Y2goKGVycikgPT4ge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XHJcbiAgICAgICAgICAgIGNvZGUgPSA1MDA7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgcmVzLnN0YXR1cyhjb2RlKS5zZW5kKHVzZXIpO1xyXG59KTtcclxuLy8gIVNFQ1RJT05cclxuXHJcbi8vIFNFQ1RJT04gLSBSRVNHSVNURVIgVVNFUlxyXG5yb3V0ZXIucG9zdChcIi9yZWdpc3RlclwiLCBhc3luYyAocmVxLCByZXMpID0+IHt9KTtcclxuXHJcbi8vIFNFQ1RJT04gLSBMT0dJTiBVU0VSXHJcbi8vIExvZ2luIGEgdXNlclxyXG5yb3V0ZXIucG9zdChcIi9sb2dpblwiLCBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICAgIGxldCB1c2VyO1xyXG4gICAgbGV0IGNvZGUgPSAyMDA7XHJcbiAgICBsZXQgZW1haWwgPSByZXEuYm9keS5lbWFpbDtcclxuICAgIGVtYWlsID0gZW1haWwucmVwbGFjZSgvIC9nLCBcIlwiKTsgLy8gU3RyaXAgd2hpdGUgc3BhY2VzXHJcbiAgICBsZXQgcGFzc3dvcmQgPSByZXEuYm9keS5wYXNzd29yZDtcclxuXHJcbiAgICBhd2FpdCBEQi5mZXRjaFVzZXJCeUVtYWlsKGVtYWlsKVxyXG4gICAgICAgIC50aGVuKChyZXMpID0+IHtcclxuICAgICAgICAgICAgdXNlciA9IHJlcztcclxuICAgICAgICAgICAgY29kZSA9IHJlcyA/IDIwMCA6IDQwMDtcclxuICAgICAgICB9KVxyXG4gICAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcclxuICAgICAgICAgICAgY29kZSA9IDUwMDtcclxuICAgICAgICB9KTtcclxuICAgIGlmIChjb2RlID09IDQwMCkge1xyXG4gICAgICAgIHJlcy5zdGF0dXMoY29kZSkuc2VuZChcImNvdWxkIG5vdCBmaW5kIGEgdXNlciB3aXRoIHRoYXQgZW1haWwgYWRkcmVzc1wiKTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgYXdhaXQgYmNyeXB0XHJcbiAgICAgICAgLmNvbXBhcmUocGFzc3dvcmQsIHVzZXIudXNlcmluZm8uaGFzaClcclxuICAgICAgICAudGhlbigoc3VjY2VzcykgPT4ge1xyXG4gICAgICAgICAgICBpZiAoIXN1Y2Nlc3MpIHtcclxuICAgICAgICAgICAgICAgIGNvZGUgPSA0MDM7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG4gICAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICBpZiAoY29kZSA9PSA0MDMpIHtcclxuICAgICAgICByZXMuc3RhdHVzKGNvZGUpLnNlbmQoXCJpbnZhbGlkIGxvZ2luIGNyZWRlbnRpYWxzXCIpO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICByZXMuc3RhdHVzKGNvZGUpLnNlbmQodXNlcik7XHJcbiAgICAvLyBUT0RPIC0gTWFrZSB0aGlzIG1vcmUgbGVnaXRhbWF0ZVxyXG4gICAgLy8gVE9ETyAtIE1ha2Ugc29tZSB0ZXN0c1xyXG59KTtcclxuLy8gIVNFQ1RJT05cclxuXHJcbi8vIFRPRE8gLSBVcGRhdGUgRW1haWxcclxuLy8gVE9ETyAtIFJlc2V0IC8gUmVjb3ZlciBQYXNzd29yZFxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSByb3V0ZXI7XHJcbiJdfQ==