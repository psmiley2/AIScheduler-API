function cov_zcw5eg62c(){var path="C:\\Users\\peter\\Desktop\\Files\\perhail\\server\\routes\\users.js";var hash="d4530a81c6cf60a78716de3bfe7dda46ca3709d5";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"C:\\Users\\peter\\Desktop\\Files\\perhail\\server\\routes\\users.js",statementMap:{"0":{start:{line:1,column:16},end:{line:1,column:34}},"1":{start:{line:2,column:15},end:{line:2,column:34}},"2":{start:{line:3,column:15},end:{line:3,column:31}},"3":{start:{line:7,column:0},end:{line:42,column:3}},"4":{start:{line:9,column:19},end:{line:12,column:5}},"5":{start:{line:13,column:15},end:{line:13,column:18}},"6":{start:{line:14,column:17},end:{line:14,column:63}},"7":{start:{line:15,column:4},end:{line:15,column:25}},"8":{start:{line:17,column:15},end:{line:24,column:5}},"9":{start:{line:26,column:4},end:{line:34,column:44}},"10":{start:{line:28,column:12},end:{line:32,column:13}},"11":{start:{line:29,column:16},end:{line:29,column:27}},"12":{start:{line:31,column:16},end:{line:31,column:28}},"13":{start:{line:34,column:24},end:{line:34,column:42}},"14":{start:{line:35,column:4},end:{line:41,column:5}},"15":{start:{line:36,column:8},end:{line:36,column:36}},"16":{start:{line:38,column:8},end:{line:40,column:10}},"17":{start:{line:47,column:0},end:{line:70,column:3}},"18":{start:{line:49,column:15},end:{line:49,column:18}},"19":{start:{line:50,column:17},end:{line:50,column:34}},"20":{start:{line:52,column:4},end:{line:55,column:5}},"21":{start:{line:53,column:8},end:{line:53,column:49}},"22":{start:{line:54,column:8},end:{line:54,column:15}},"23":{start:{line:57,column:4},end:{line:57,column:34}},"24":{start:{line:59,column:4},end:{line:67,column:11}},"25":{start:{line:61,column:12},end:{line:61,column:23}},"26":{start:{line:62,column:12},end:{line:62,column:35}},"27":{start:{line:65,column:12},end:{line:65,column:31}},"28":{start:{line:66,column:12},end:{line:66,column:23}},"29":{start:{line:69,column:4},end:{line:69,column:32}},"30":{start:{line:75,column:0},end:{line:115,column:3}},"31":{start:{line:77,column:15},end:{line:77,column:18}},"32":{start:{line:78,column:16},end:{line:78,column:30}},"33":{start:{line:79,column:4},end:{line:79,column:36}},"34":{start:{line:80,column:19},end:{line:80,column:36}},"35":{start:{line:82,column:4},end:{line:90,column:11}},"36":{start:{line:84,column:12},end:{line:84,column:23}},"37":{start:{line:85,column:12},end:{line:85,column:35}},"38":{start:{line:88,column:12},end:{line:88,column:31}},"39":{start:{line:89,column:12},end:{line:89,column:23}},"40":{start:{line:91,column:4},end:{line:94,column:5}},"41":{start:{line:92,column:8},end:{line:92,column:79}},"42":{start:{line:93,column:8},end:{line:93,column:15}},"43":{start:{line:96,column:4},end:{line:105,column:11}},"44":{start:{line:99,column:12},end:{line:101,column:13}},"45":{start:{line:100,column:16},end:{line:100,column:27}},"46":{start:{line:104,column:12},end:{line:104,column:31}},"47":{start:{line:107,column:4},end:{line:110,column:5}},"48":{start:{line:108,column:8},end:{line:108,column:59}},"49":{start:{line:109,column:8},end:{line:109,column:15}},"50":{start:{line:112,column:4},end:{line:112,column:32}},"51":{start:{line:121,column:0},end:{line:121,column:24}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:7,column:22},end:{line:7,column:23}},loc:{start:{line:7,column:42},end:{line:42,column:1}},line:7},"1":{name:"(anonymous_1)",decl:{start:{line:27,column:14},end:{line:27,column:15}},loc:{start:{line:27,column:23},end:{line:33,column:9}},line:27},"2":{name:"(anonymous_2)",decl:{start:{line:34,column:15},end:{line:34,column:16}},loc:{start:{line:34,column:24},end:{line:34,column:42}},line:34},"3":{name:"(anonymous_3)",decl:{start:{line:47,column:29},end:{line:47,column:30}},loc:{start:{line:47,column:49},end:{line:70,column:1}},line:47},"4":{name:"(anonymous_4)",decl:{start:{line:60,column:14},end:{line:60,column:15}},loc:{start:{line:60,column:23},end:{line:63,column:9}},line:60},"5":{name:"(anonymous_5)",decl:{start:{line:64,column:15},end:{line:64,column:16}},loc:{start:{line:64,column:24},end:{line:67,column:9}},line:64},"6":{name:"(anonymous_6)",decl:{start:{line:75,column:22},end:{line:75,column:23}},loc:{start:{line:75,column:42},end:{line:115,column:1}},line:75},"7":{name:"(anonymous_7)",decl:{start:{line:83,column:14},end:{line:83,column:15}},loc:{start:{line:83,column:23},end:{line:86,column:9}},line:83},"8":{name:"(anonymous_8)",decl:{start:{line:87,column:15},end:{line:87,column:16}},loc:{start:{line:87,column:24},end:{line:90,column:9}},line:87},"9":{name:"(anonymous_9)",decl:{start:{line:98,column:14},end:{line:98,column:15}},loc:{start:{line:98,column:27},end:{line:102,column:9}},line:98},"10":{name:"(anonymous_10)",decl:{start:{line:103,column:15},end:{line:103,column:16}},loc:{start:{line:103,column:24},end:{line:105,column:9}},line:103}},branchMap:{"0":{loc:{start:{line:28,column:12},end:{line:32,column:13}},type:"if",locations:[{start:{line:28,column:12},end:{line:32,column:13}},{start:{line:28,column:12},end:{line:32,column:13}}],line:28},"1":{loc:{start:{line:35,column:4},end:{line:41,column:5}},type:"if",locations:[{start:{line:35,column:4},end:{line:41,column:5}},{start:{line:35,column:4},end:{line:41,column:5}}],line:35},"2":{loc:{start:{line:52,column:4},end:{line:55,column:5}},type:"if",locations:[{start:{line:52,column:4},end:{line:55,column:5}},{start:{line:52,column:4},end:{line:55,column:5}}],line:52},"3":{loc:{start:{line:62,column:19},end:{line:62,column:34}},type:"cond-expr",locations:[{start:{line:62,column:25},end:{line:62,column:28}},{start:{line:62,column:31},end:{line:62,column:34}}],line:62},"4":{loc:{start:{line:85,column:19},end:{line:85,column:34}},type:"cond-expr",locations:[{start:{line:85,column:25},end:{line:85,column:28}},{start:{line:85,column:31},end:{line:85,column:34}}],line:85},"5":{loc:{start:{line:91,column:4},end:{line:94,column:5}},type:"if",locations:[{start:{line:91,column:4},end:{line:94,column:5}},{start:{line:91,column:4},end:{line:94,column:5}}],line:91},"6":{loc:{start:{line:99,column:12},end:{line:101,column:13}},type:"if",locations:[{start:{line:99,column:12},end:{line:101,column:13}},{start:{line:99,column:12},end:{line:101,column:13}}],line:99},"7":{loc:{start:{line:107,column:4},end:{line:110,column:5}},type:"if",locations:[{start:{line:107,column:4},end:{line:110,column:5}},{start:{line:107,column:4},end:{line:110,column:5}}],line:107}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"d4530a81c6cf60a78716de3bfe7dda46ca3709d5"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_zcw5eg62c=function(){return actualCoverage;};}return actualCoverage;}cov_zcw5eg62c();const express=(cov_zcw5eg62c().s[0]++,require("express"));const bcrypt=(cov_zcw5eg62c().s[1]++,require("bcryptjs"));const router=(cov_zcw5eg62c().s[2]++,express.Router());// SECTION - CREATE USER
// Create a new user
cov_zcw5eg62c().s[3]++;router.post("/users",async(req,res)=>{cov_zcw5eg62c().f[0]++;// TODO - Validation
let userInfo=(cov_zcw5eg62c().s[4]++,{email:req.body.email,hash:""});let code=(cov_zcw5eg62c().s[5]++,400);const hash=(cov_zcw5eg62c().s[6]++,bcrypt.hashSync(req.body.password,saltRounds));cov_zcw5eg62c().s[7]++;userInfo.hash=hash;let user=(cov_zcw5eg62c().s[8]++,{userinfo:userInfo,tasklists:[],preferences:[],tracks:[],goals:[],events:[]});cov_zcw5eg62c().s[9]++;await DB.insertUser(user).then(res=>{cov_zcw5eg62c().f[1]++;cov_zcw5eg62c().s[10]++;if(res==1){cov_zcw5eg62c().b[0][0]++;cov_zcw5eg62c().s[11]++;code=201;}else{cov_zcw5eg62c().b[0][1]++;cov_zcw5eg62c().s[12]++;code==500;}}).catch(err=>{cov_zcw5eg62c().f[2]++;cov_zcw5eg62c().s[13]++;return console.error(err);});cov_zcw5eg62c().s[14]++;if(code==201){cov_zcw5eg62c().b[1][0]++;cov_zcw5eg62c().s[15]++;res.status(code).send(user);}else{cov_zcw5eg62c().b[1][1]++;cov_zcw5eg62c().s[16]++;res.status(code).send("Unexpected error occured. Check Database connection");}});// !SECTION
// SECTION - FETCH USER
// Fetch an existing user
cov_zcw5eg62c().s[17]++;router.get("/users/:userid",async(req,res)=>{cov_zcw5eg62c().f[3]++;let user;let code=(cov_zcw5eg62c().s[18]++,400);let userid=(cov_zcw5eg62c().s[19]++,req.params.userid);cov_zcw5eg62c().s[20]++;if(userid.length!=24){cov_zcw5eg62c().b[2][0]++;cov_zcw5eg62c().s[21]++;res.status(code).send("invalid user id");cov_zcw5eg62c().s[22]++;return;}else{cov_zcw5eg62c().b[2][1]++;}cov_zcw5eg62c().s[23]++;userid=new ObjectID(userid);cov_zcw5eg62c().s[24]++;await DB.fetchUser(userid).then(res=>{cov_zcw5eg62c().f[4]++;cov_zcw5eg62c().s[25]++;user=res;cov_zcw5eg62c().s[26]++;code=res?(cov_zcw5eg62c().b[3][0]++,200):(cov_zcw5eg62c().b[3][1]++,400);}).catch(err=>{cov_zcw5eg62c().f[5]++;cov_zcw5eg62c().s[27]++;console.error(err);cov_zcw5eg62c().s[28]++;code=500;});cov_zcw5eg62c().s[29]++;res.status(code).send(user);});// !SECTION
// SECTION - FETCH USER
// Fetch an existing user
cov_zcw5eg62c().s[30]++;router.post("/login",async(req,res)=>{cov_zcw5eg62c().f[6]++;let user;let code=(cov_zcw5eg62c().s[31]++,200);let email=(cov_zcw5eg62c().s[32]++,req.body.email);cov_zcw5eg62c().s[33]++;email=email.replace(/ /g,"");// Strip white spaces
let password=(cov_zcw5eg62c().s[34]++,req.body.password);cov_zcw5eg62c().s[35]++;await DB.fetchUserByEmail(email).then(res=>{cov_zcw5eg62c().f[7]++;cov_zcw5eg62c().s[36]++;user=res;cov_zcw5eg62c().s[37]++;code=res?(cov_zcw5eg62c().b[4][0]++,200):(cov_zcw5eg62c().b[4][1]++,400);}).catch(err=>{cov_zcw5eg62c().f[8]++;cov_zcw5eg62c().s[38]++;console.error(err);cov_zcw5eg62c().s[39]++;code=500;});cov_zcw5eg62c().s[40]++;if(code==400){cov_zcw5eg62c().b[5][0]++;cov_zcw5eg62c().s[41]++;res.status(code).send("could not find a user with that email address");cov_zcw5eg62c().s[42]++;return;}else{cov_zcw5eg62c().b[5][1]++;}cov_zcw5eg62c().s[43]++;await bcrypt.compare(password,user.userinfo.hash).then(success=>{cov_zcw5eg62c().f[9]++;cov_zcw5eg62c().s[44]++;if(!success){cov_zcw5eg62c().b[6][0]++;cov_zcw5eg62c().s[45]++;code=403;}else{cov_zcw5eg62c().b[6][1]++;}}).catch(err=>{cov_zcw5eg62c().f[10]++;cov_zcw5eg62c().s[46]++;console.error(err);});cov_zcw5eg62c().s[47]++;if(code==403){cov_zcw5eg62c().b[7][0]++;cov_zcw5eg62c().s[48]++;res.status(code).send("invalid login credentials");cov_zcw5eg62c().s[49]++;return;}else{cov_zcw5eg62c().b[7][1]++;}cov_zcw5eg62c().s[50]++;res.status(code).send(user);// TODO - Make this more legitamate
// TODO - Make some tests
});// !SECTION
// TODO - Update Email
// TODO - Reset / Recover Password
cov_zcw5eg62c().s[51]++;module.exports=router;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInVzZXJzLmpzIl0sIm5hbWVzIjpbImV4cHJlc3MiLCJyZXF1aXJlIiwiYmNyeXB0Iiwicm91dGVyIiwiUm91dGVyIiwicG9zdCIsInJlcSIsInJlcyIsInVzZXJJbmZvIiwiZW1haWwiLCJib2R5IiwiaGFzaCIsImNvZGUiLCJoYXNoU3luYyIsInBhc3N3b3JkIiwic2FsdFJvdW5kcyIsInVzZXIiLCJ1c2VyaW5mbyIsInRhc2tsaXN0cyIsInByZWZlcmVuY2VzIiwidHJhY2tzIiwiZ29hbHMiLCJldmVudHMiLCJEQiIsImluc2VydFVzZXIiLCJ0aGVuIiwiY2F0Y2giLCJlcnIiLCJjb25zb2xlIiwiZXJyb3IiLCJzdGF0dXMiLCJzZW5kIiwiZ2V0IiwidXNlcmlkIiwicGFyYW1zIiwibGVuZ3RoIiwiT2JqZWN0SUQiLCJmZXRjaFVzZXIiLCJyZXBsYWNlIiwiZmV0Y2hVc2VyQnlFbWFpbCIsImNvbXBhcmUiLCJzdWNjZXNzIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IjRrT0FlWTt5RkFmWixLQUFNQSxDQUFBQSxPQUFPLHlCQUFHQyxPQUFPLENBQUMsU0FBRCxDQUFWLENBQWIsQ0FDQSxLQUFNQyxDQUFBQSxNQUFNLHlCQUFHRCxPQUFPLENBQUMsVUFBRCxDQUFWLENBQVosQ0FDQSxLQUFNRSxDQUFBQSxNQUFNLHlCQUFHSCxPQUFPLENBQUNJLE1BQVIsRUFBSCxDQUFaLENBRUE7QUFDQTt1QkFDQUQsTUFBTSxDQUFDRSxJQUFQLENBQVksUUFBWixDQUFzQixNQUFPQyxHQUFQLENBQVlDLEdBQVosR0FBb0Isd0JBQ3RDO0FBQ0EsR0FBSUMsQ0FBQUEsUUFBUSx5QkFBRyxDQUNYQyxLQUFLLENBQUVILEdBQUcsQ0FBQ0ksSUFBSixDQUFTRCxLQURMLENBRVhFLElBQUksQ0FBRSxFQUZLLENBQUgsQ0FBWixDQUlBLEdBQUlDLENBQUFBLElBQUkseUJBQUcsR0FBSCxDQUFSLENBQ0EsS0FBTUQsQ0FBQUEsSUFBSSx5QkFBR1QsTUFBTSxDQUFDVyxRQUFQLENBQWdCUCxHQUFHLENBQUNJLElBQUosQ0FBU0ksUUFBekIsQ0FBbUNDLFVBQW5DLENBQUgsQ0FBVixDQVBzQyx1QkFRdENQLFFBQVEsQ0FBQ0csSUFBVCxDQUFnQkEsSUFBaEIsQ0FFQSxHQUFJSyxDQUFBQSxJQUFJLHlCQUFHLENBQ1BDLFFBQVEsQ0FBRVQsUUFESCxDQUVQVSxTQUFTLENBQUUsRUFGSixDQUdQQyxXQUFXLENBQUUsRUFITixDQUlQQyxNQUFNLENBQUUsRUFKRCxDQUtQQyxLQUFLLENBQUUsRUFMQSxDQU1QQyxNQUFNLENBQUUsRUFORCxDQUFILENBQVIsQ0FWc0MsdUJBbUJ0QyxLQUFNQyxDQUFBQSxFQUFFLENBQUNDLFVBQUgsQ0FBY1IsSUFBZCxFQUNEUyxJQURDLENBQ0tsQixHQUFELEVBQVMsZ0RBQ1gsR0FBSUEsR0FBRyxFQUFJLENBQVgsQ0FBYyxtREFDVkssSUFBSSxDQUFHLEdBQVAsQ0FDSCxDQUZELElBRU8sbURBQ0hBLElBQUksRUFBSSxHQUFSLENBQ0gsQ0FDSixDQVBDLEVBUURjLEtBUkMsQ0FRTUMsR0FBRCxFQUFTLHNEQUFBQyxDQUFBQSxPQUFPLENBQUNDLEtBQVIsQ0FBY0YsR0FBZCxFQUFrQixDQVJoQyxDQUFOLENBbkJzQyx3QkE0QnRDLEdBQUlmLElBQUksRUFBSSxHQUFaLENBQWlCLG1EQUNiTCxHQUFHLENBQUN1QixNQUFKLENBQVdsQixJQUFYLEVBQWlCbUIsSUFBakIsQ0FBc0JmLElBQXRCLEVBQ0gsQ0FGRCxJQUVPLG1EQUNIVCxHQUFHLENBQUN1QixNQUFKLENBQVdsQixJQUFYLEVBQWlCbUIsSUFBakIsQ0FDSSxxREFESixFQUdILENBQ0osQ0FuQ0QsRUFvQ0E7QUFFQTtBQUNBO3dCQUNBNUIsTUFBTSxDQUFDNkIsR0FBUCxDQUFXLGdCQUFYLENBQTZCLE1BQU8xQixHQUFQLENBQVlDLEdBQVosR0FBb0Isd0JBQzdDLEdBQUlTLENBQUFBLElBQUosQ0FDQSxHQUFJSixDQUFBQSxJQUFJLDBCQUFHLEdBQUgsQ0FBUixDQUNBLEdBQUlxQixDQUFBQSxNQUFNLDBCQUFHM0IsR0FBRyxDQUFDNEIsTUFBSixDQUFXRCxNQUFkLENBQVYsQ0FINkMsd0JBSzdDLEdBQUlBLE1BQU0sQ0FBQ0UsTUFBUCxFQUFpQixFQUFyQixDQUF5QixtREFDckI1QixHQUFHLENBQUN1QixNQUFKLENBQVdsQixJQUFYLEVBQWlCbUIsSUFBakIsQ0FBc0IsaUJBQXRCLEVBRHFCLHdCQUVyQixPQUNILENBSEQsZ0NBTDZDLHdCQVU3Q0UsTUFBTSxDQUFHLEdBQUlHLENBQUFBLFFBQUosQ0FBYUgsTUFBYixDQUFULENBVjZDLHdCQVk3QyxLQUFNVixDQUFBQSxFQUFFLENBQUNjLFNBQUgsQ0FBYUosTUFBYixFQUNEUixJQURDLENBQ0tsQixHQUFELEVBQVMsZ0RBQ1hTLElBQUksQ0FBR1QsR0FBUCxDQURXLHdCQUVYSyxJQUFJLENBQUdMLEdBQUcsNEJBQUcsR0FBSCw2QkFBUyxHQUFULENBQVYsQ0FDSCxDQUpDLEVBS0RtQixLQUxDLENBS01DLEdBQUQsRUFBUyxnREFDWkMsT0FBTyxDQUFDQyxLQUFSLENBQWNGLEdBQWQsRUFEWSx3QkFFWmYsSUFBSSxDQUFHLEdBQVAsQ0FDSCxDQVJDLENBQU4sQ0FaNkMsd0JBc0I3Q0wsR0FBRyxDQUFDdUIsTUFBSixDQUFXbEIsSUFBWCxFQUFpQm1CLElBQWpCLENBQXNCZixJQUF0QixFQUNILENBdkJELEVBd0JBO0FBRUE7QUFDQTt3QkFDQWIsTUFBTSxDQUFDRSxJQUFQLENBQVksUUFBWixDQUFzQixNQUFPQyxHQUFQLENBQVlDLEdBQVosR0FBb0Isd0JBQ3RDLEdBQUlTLENBQUFBLElBQUosQ0FDQSxHQUFJSixDQUFBQSxJQUFJLDBCQUFHLEdBQUgsQ0FBUixDQUNBLEdBQUlILENBQUFBLEtBQUssMEJBQUdILEdBQUcsQ0FBQ0ksSUFBSixDQUFTRCxLQUFaLENBQVQsQ0FIc0Msd0JBSXRDQSxLQUFLLENBQUdBLEtBQUssQ0FBQzZCLE9BQU4sQ0FBYyxJQUFkLENBQW9CLEVBQXBCLENBQVIsQ0FBaUM7QUFDakMsR0FBSXhCLENBQUFBLFFBQVEsMEJBQUdSLEdBQUcsQ0FBQ0ksSUFBSixDQUFTSSxRQUFaLENBQVosQ0FMc0Msd0JBT3RDLEtBQU1TLENBQUFBLEVBQUUsQ0FBQ2dCLGdCQUFILENBQW9COUIsS0FBcEIsRUFDRGdCLElBREMsQ0FDS2xCLEdBQUQsRUFBUyxnREFDWFMsSUFBSSxDQUFHVCxHQUFQLENBRFcsd0JBRVhLLElBQUksQ0FBR0wsR0FBRyw0QkFBRyxHQUFILDZCQUFTLEdBQVQsQ0FBVixDQUNILENBSkMsRUFLRG1CLEtBTEMsQ0FLTUMsR0FBRCxFQUFTLGdEQUNaQyxPQUFPLENBQUNDLEtBQVIsQ0FBY0YsR0FBZCxFQURZLHdCQUVaZixJQUFJLENBQUcsR0FBUCxDQUNILENBUkMsQ0FBTixDQVBzQyx3QkFnQnRDLEdBQUlBLElBQUksRUFBSSxHQUFaLENBQWlCLG1EQUNiTCxHQUFHLENBQUN1QixNQUFKLENBQVdsQixJQUFYLEVBQWlCbUIsSUFBakIsQ0FBc0IsK0NBQXRCLEVBRGEsd0JBRWIsT0FDSCxDQUhELGdDQWhCc0Msd0JBcUJ0QyxLQUFNN0IsQ0FBQUEsTUFBTSxDQUNQc0MsT0FEQyxDQUNPMUIsUUFEUCxDQUNpQkUsSUFBSSxDQUFDQyxRQUFMLENBQWNOLElBRC9CLEVBRURjLElBRkMsQ0FFS2dCLE9BQUQsRUFBYSxnREFDZixHQUFJLENBQUNBLE9BQUwsQ0FBYyxtREFDVjdCLElBQUksQ0FBRyxHQUFQLENBQ0gsQ0FGRCxnQ0FHSCxDQU5DLEVBT0RjLEtBUEMsQ0FPTUMsR0FBRCxFQUFTLGlEQUNaQyxPQUFPLENBQUNDLEtBQVIsQ0FBY0YsR0FBZCxFQUNILENBVEMsQ0FBTixDQXJCc0Msd0JBZ0N0QyxHQUFJZixJQUFJLEVBQUksR0FBWixDQUFpQixtREFDYkwsR0FBRyxDQUFDdUIsTUFBSixDQUFXbEIsSUFBWCxFQUFpQm1CLElBQWpCLENBQXNCLDJCQUF0QixFQURhLHdCQUViLE9BQ0gsQ0FIRCxnQ0FoQ3NDLHdCQXFDdEN4QixHQUFHLENBQUN1QixNQUFKLENBQVdsQixJQUFYLEVBQWlCbUIsSUFBakIsQ0FBc0JmLElBQXRCLEVBQ0E7QUFDQTtBQUNILENBeENELEVBeUNBO0FBRUE7QUFDQTt3QkFFQTBCLE1BQU0sQ0FBQ0MsT0FBUCxDQUFpQnhDLE1BQWpCIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgZXhwcmVzcyA9IHJlcXVpcmUoXCJleHByZXNzXCIpO1xyXG5jb25zdCBiY3J5cHQgPSByZXF1aXJlKFwiYmNyeXB0anNcIik7XHJcbmNvbnN0IHJvdXRlciA9IGV4cHJlc3MuUm91dGVyKCk7XHJcblxyXG4vLyBTRUNUSU9OIC0gQ1JFQVRFIFVTRVJcclxuLy8gQ3JlYXRlIGEgbmV3IHVzZXJcclxucm91dGVyLnBvc3QoXCIvdXNlcnNcIiwgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgICAvLyBUT0RPIC0gVmFsaWRhdGlvblxyXG4gICAgbGV0IHVzZXJJbmZvID0ge1xyXG4gICAgICAgIGVtYWlsOiByZXEuYm9keS5lbWFpbCxcclxuICAgICAgICBoYXNoOiBcIlwiLFxyXG4gICAgfTtcclxuICAgIGxldCBjb2RlID0gNDAwO1xyXG4gICAgY29uc3QgaGFzaCA9IGJjcnlwdC5oYXNoU3luYyhyZXEuYm9keS5wYXNzd29yZCwgc2FsdFJvdW5kcyk7XHJcbiAgICB1c2VySW5mby5oYXNoID0gaGFzaDtcclxuXHJcbiAgICBsZXQgdXNlciA9IHtcclxuICAgICAgICB1c2VyaW5mbzogdXNlckluZm8sXHJcbiAgICAgICAgdGFza2xpc3RzOiBbXSxcclxuICAgICAgICBwcmVmZXJlbmNlczogW10sXHJcbiAgICAgICAgdHJhY2tzOiBbXSxcclxuICAgICAgICBnb2FsczogW10sXHJcbiAgICAgICAgZXZlbnRzOiBbXSxcclxuICAgIH07XHJcblxyXG4gICAgYXdhaXQgREIuaW5zZXJ0VXNlcih1c2VyKVxyXG4gICAgICAgIC50aGVuKChyZXMpID0+IHtcclxuICAgICAgICAgICAgaWYgKHJlcyA9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICBjb2RlID0gMjAxO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgY29kZSA9PSA1MDA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG4gICAgICAgIC5jYXRjaCgoZXJyKSA9PiBjb25zb2xlLmVycm9yKGVycikpO1xyXG4gICAgaWYgKGNvZGUgPT0gMjAxKSB7XHJcbiAgICAgICAgcmVzLnN0YXR1cyhjb2RlKS5zZW5kKHVzZXIpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICByZXMuc3RhdHVzKGNvZGUpLnNlbmQoXHJcbiAgICAgICAgICAgIFwiVW5leHBlY3RlZCBlcnJvciBvY2N1cmVkLiBDaGVjayBEYXRhYmFzZSBjb25uZWN0aW9uXCJcclxuICAgICAgICApO1xyXG4gICAgfVxyXG59KTtcclxuLy8gIVNFQ1RJT05cclxuXHJcbi8vIFNFQ1RJT04gLSBGRVRDSCBVU0VSXHJcbi8vIEZldGNoIGFuIGV4aXN0aW5nIHVzZXJcclxucm91dGVyLmdldChcIi91c2Vycy86dXNlcmlkXCIsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xyXG4gICAgbGV0IHVzZXI7XHJcbiAgICBsZXQgY29kZSA9IDQwMDtcclxuICAgIGxldCB1c2VyaWQgPSByZXEucGFyYW1zLnVzZXJpZDtcclxuXHJcbiAgICBpZiAodXNlcmlkLmxlbmd0aCAhPSAyNCkge1xyXG4gICAgICAgIHJlcy5zdGF0dXMoY29kZSkuc2VuZChcImludmFsaWQgdXNlciBpZFwiKTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgdXNlcmlkID0gbmV3IE9iamVjdElEKHVzZXJpZCk7XHJcblxyXG4gICAgYXdhaXQgREIuZmV0Y2hVc2VyKHVzZXJpZClcclxuICAgICAgICAudGhlbigocmVzKSA9PiB7XHJcbiAgICAgICAgICAgIHVzZXIgPSByZXM7XHJcbiAgICAgICAgICAgIGNvZGUgPSByZXMgPyAyMDAgOiA0MDA7XHJcbiAgICAgICAgfSlcclxuICAgICAgICAuY2F0Y2goKGVycikgPT4ge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XHJcbiAgICAgICAgICAgIGNvZGUgPSA1MDA7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgcmVzLnN0YXR1cyhjb2RlKS5zZW5kKHVzZXIpO1xyXG59KTtcclxuLy8gIVNFQ1RJT05cclxuXHJcbi8vIFNFQ1RJT04gLSBGRVRDSCBVU0VSXHJcbi8vIEZldGNoIGFuIGV4aXN0aW5nIHVzZXJcclxucm91dGVyLnBvc3QoXCIvbG9naW5cIiwgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgICBsZXQgdXNlcjtcclxuICAgIGxldCBjb2RlID0gMjAwO1xyXG4gICAgbGV0IGVtYWlsID0gcmVxLmJvZHkuZW1haWw7XHJcbiAgICBlbWFpbCA9IGVtYWlsLnJlcGxhY2UoLyAvZywgXCJcIik7IC8vIFN0cmlwIHdoaXRlIHNwYWNlc1xyXG4gICAgbGV0IHBhc3N3b3JkID0gcmVxLmJvZHkucGFzc3dvcmQ7XHJcblxyXG4gICAgYXdhaXQgREIuZmV0Y2hVc2VyQnlFbWFpbChlbWFpbClcclxuICAgICAgICAudGhlbigocmVzKSA9PiB7XHJcbiAgICAgICAgICAgIHVzZXIgPSByZXM7XHJcbiAgICAgICAgICAgIGNvZGUgPSByZXMgPyAyMDAgOiA0MDA7XHJcbiAgICAgICAgfSlcclxuICAgICAgICAuY2F0Y2goKGVycikgPT4ge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XHJcbiAgICAgICAgICAgIGNvZGUgPSA1MDA7XHJcbiAgICAgICAgfSk7XHJcbiAgICBpZiAoY29kZSA9PSA0MDApIHtcclxuICAgICAgICByZXMuc3RhdHVzKGNvZGUpLnNlbmQoXCJjb3VsZCBub3QgZmluZCBhIHVzZXIgd2l0aCB0aGF0IGVtYWlsIGFkZHJlc3NcIik7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGF3YWl0IGJjcnlwdFxyXG4gICAgICAgIC5jb21wYXJlKHBhc3N3b3JkLCB1c2VyLnVzZXJpbmZvLmhhc2gpXHJcbiAgICAgICAgLnRoZW4oKHN1Y2Nlc3MpID0+IHtcclxuICAgICAgICAgICAgaWYgKCFzdWNjZXNzKSB7XHJcbiAgICAgICAgICAgICAgICBjb2RlID0gNDAzO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSlcclxuICAgICAgICAuY2F0Y2goKGVycikgPT4ge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgaWYgKGNvZGUgPT0gNDAzKSB7XHJcbiAgICAgICAgcmVzLnN0YXR1cyhjb2RlKS5zZW5kKFwiaW52YWxpZCBsb2dpbiBjcmVkZW50aWFsc1wiKTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgcmVzLnN0YXR1cyhjb2RlKS5zZW5kKHVzZXIpO1xyXG4gICAgLy8gVE9ETyAtIE1ha2UgdGhpcyBtb3JlIGxlZ2l0YW1hdGVcclxuICAgIC8vIFRPRE8gLSBNYWtlIHNvbWUgdGVzdHNcclxufSk7XHJcbi8vICFTRUNUSU9OXHJcblxyXG4vLyBUT0RPIC0gVXBkYXRlIEVtYWlsXHJcbi8vIFRPRE8gLSBSZXNldCAvIFJlY292ZXIgUGFzc3dvcmRcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gcm91dGVyO1xyXG4iXX0=